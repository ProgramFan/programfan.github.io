<!DOCTYPE HTML>
<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <title>ProgramFan's Writing Space - Blog</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="generator" content="Jekyll v2.5.3">
  <link rel="alternate" type="application/rss+xml"
        title="ProgramFan • Research, Learning, Thinking and Growing up - Feed" href="/feed.xml">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic,900">
  <link rel="stylesheet" href="/css/screen.css">
  <!-- <link rel="stylesheet" href="/css/prism.css"> -->
  <!-- <script src="/js/prism.min.js" type="text/javascript"></script> -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <!--[if lt IE 9]>
  <script src="/js/html5shiv.min.js"></script>
  <script src="/js/respond.min.js"></script>
  <![endif]-->
  <link href="/css/katex.min.css" rel="stylesheet" type="text/css">
  <script src="/js/katex.min.js" type="text/javascript"></script>
  <script src="/js/auto-render.min.js" type="text/javascript"></script>
</head>


<body class="wrap">
  <header role="banner">
  <nav class="mobile-nav show-on-mobiles">
    <ul>
  <li class="">
    <a href="/">Home</a>
  </li>
  <li class="current">
    <a href="/blog/">Blog</a>
  </li>
  <li class="">
    <a href="/about/">About</a>
  </li>
  <li>
    <a href="https://github.com/ProgramFan">View on GitHub</a>
  </li>
</ul>

  </nav>
  <div class="grid">
    <div class="unit one-third center-on-mobiles">
      <h1>
        <a href="/">
          <span class="sr-only">ProgramFan's Writing Space</span>
          <img src="/img/logo-2x.png" width="300" height="115" alt="Site Logo">
        </a>
      </h1>
    </div>
    <nav class="main-nav unit two-thirds hide-on-mobiles">
      <ul>
  <li class="">
    <a href="/">Home</a>
  </li>
  <li class="current">
    <a href="/blog/">Blog</a>
  </li>
  <li class="">
    <a href="/about/">About</a>
  </li>
  <li>
    <a href="https://github.com/ProgramFan">View on GitHub</a>
  </li>
</ul>

    </nav>
  </div>
</header>


    <section class="news">
    <div class="grid">

      <div class="docs-nav-mobile unit whole show-on-mobiles">
  <select onchange="if (this.value) window.location.href=this.value">
    <option value="">Navigate the blog…</option>
    <option value="/news/">Home</option>
    <optgroup label="v1.x">
      
      <option value="/contents/2015/10/02/deploy-python-working-environments-using-pip/">Deploy python working environments with pip under restricted connections</option>
      
      <option value="/contents/2015/09/20/user-local-python-pkg-install-with-pip/">User-local python package install with pip</option>
      
      <option value="/contents/2015/09/05/analyse-mpi-applications-with-intel-vtune-inspector/">Analyse MPI Applications with Intel VTune/Inspector</option>
      
      <option value="/contents/2015/07/25/home-python-ruby-with-pyenv-and-rvm/">Home-brew python and ruby with PyENV and RVM</option>
      
      <option value="/contents/2015/07/11/config-cjk-for-asciidoctor-fopub/">Config CJK fonts for Asciidoctor-fopub</option>
      
      <option value="/contents/2015/06/23/asciidoc-pdf-cjk-status/">Asciidoctor-pdf CJK support status</option>
      
      <option value="/contents/2015/05/05/using-rvm-to-isolate-rubygems-on-fedora-21/">Using RVM to Isolate RubyGems on Fedora 21</option>
      
      <option value="/contents/2015/05/01/fix-boost-python-argument-error-lvalue/">Fix Argument Error with lvalue In Boost.Python</option>
      
      <option value="/contents/2015/04/27/prevent-gcc-optimize-away-code/">Prevent GCC from optimizing away a snippet of code</option>
      
      <option value="/contents/2015/04/20/convert-chinese-asciidoc-to-pdf/">Convert Chinese Asciidoc Documents to PDF</option>
      
    </optgroup>
  </select>
</div>


      <div class="unit four-fifths">
        <!-- Pagination pages -->

  <article>
  <h2>
    <a href="/contents/2015/10/02/deploy-python-working-environments-using-pip/">
      Deploy python working environments with pip under restricted connections
    </a>
  </h2>
  <span class="post-category">
    <span class="label">
      python, pip, working env, and featured
    </span>
  </span>
  <div class="post-meta">
    <span class="post-date">
      02 Oct 2015
    </span>
    <a href="https://github.com/ProgramFan" class="post-author">
      ProgramFan
    </a>
  </div>
  <div class="post-content">
    <div class="sect1">
<h2 id="background">Background</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One can often use pre-built python distributions to setup python working
environments, for example <a href="http://www.continuum.io">Anaconda</a>,
<a href="https://store.enthought.com">Enthought Canopy</a>. But these distributions has the
following common problems, which reduces their usefulness:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>It&#8217;s hard to upgrade packages without internet connections. It&#8217;s also hard
to install packages not contained in the distribution.</p>
</li>
<li>
<p>It does not play well with existing packages on the target systems. For
example, Anaconda bundles mpich, which conflict with system MPIs.</p>
</li>
<li>
<p>These distributions has poor performances. Since they are built on
relatively old platforms and possibly with no optimizations, they are
often slower than native python. For example, I found anaconda python on a
RHEL 6.3 system very slow to start.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For me, it&#8217;s essential to deploy my python working environments with the
following considerations:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Easy to install/upgrade packages on demand, under restricted connections.
Some systems I work with does not have internet connections.</p>
</li>
<li>
<p>It shall integrate well with existing python packages. Some packages such
as PyQt5 requires deep system integration so I would better install them
with system package manager.</p>
</li>
<li>
<p>Good performance. The distributed packages shall run fast and be
responsive on the target platform.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the-key-ideas">The key ideas</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>The first is pip user install</strong>. With <code>pip</code>, we have the most complete
python package collection. Almost all packages are available in PyPI, and we
can always make home-brew python packages pip-compatible. <code>pip</code> is a standard
python module since python 2.7.6 and is easy to install for prior python
versions. So <code>pip</code> serves as a built-in package manager. <code>pip</code> supports
installing packages in the users directory and plays well with existing
packages. For example, <code>pip install</code> will skip a package if already available
and capable. <code>pip</code> user install adds paths to standard python module paths,
instead of overwriting them.</p>
</div>
<div class="paragraph">
<p><strong>The second is python requirement file</strong>. <code>pip</code> supports install packages and
its dependencies from a <em>requirement file</em>. That is, you list packages you
want, <code>pip</code> automatically solves the dependency, grabs proper packages and
install them. It makes both install and upgrade a piece of cake.</p>
</div>
<div class="paragraph">
<p><strong>The last is python wheels</strong>. Python wheels is simply pre-built python
packages. The real power with python wheels is that you can build your own
wheel for packages in a requirement list, together with all dependencies.
After that, you can install directly from wheels without the need of a network
connection.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="in-practice">In practice</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With the above three key ideas, I develop the following method to solve the
<em>python working environment distribution</em> problem:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set up a base CPython version. One can choose to rely on system python, or
compile their own CPython.</p>
</li>
<li>
<p>Maintain a <em>requirement file</em>. Only list packages you need in the
requirements. You can also specify version constraints.</p>
</li>
<li>
<p>Build wheels for distribution.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">pip install --user --upgrade wheel
pip wheel -r requirements.txt</code></pre>
</div>
</div>
</li>
<li>
<p>Distributing wheels and install packages from wheels.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">pip install --user --upgrade -r requirements.txt --no-index -f <span class="tok-k">${</span><span class="tok-nv">WHEELSDIR</span><span class="tok-k">}</span></code></pre>
</div>
</div>
</li>
<li>
<p>Enjoy.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The above method is used to distribute my python working environments in 4
different platforms: two Fedora 22 workstations, one RHEL 6.3 system and one
RHEL 5.4 system. It works.</p>
</div>
</div>
</div>
    <br/>
    <div class="post-more">
      <a href="/contents/2015/10/02/deploy-python-working-environments-using-pip/"> <i class="fa fa-link"></i> &nbsp; Read the rest
          of this post </b></a>
    </div>
  </div>
</article>


  <article>
  <h2>
    <a href="/contents/2015/09/20/user-local-python-pkg-install-with-pip/">
      User-local python package install with pip
    </a>
  </h2>
  <span class="post-category">
    <span class="label">
      python, pip, and featured
    </span>
  </span>
  <div class="post-meta">
    <span class="post-date">
      20 Sep 2015
    </span>
    <a href="https://github.com/ProgramFan" class="post-author">
      ProgramFan
    </a>
  </div>
  <div class="post-content">
    <div class="sect1">
<h2 id="motivation">Motivation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>PyENV has done a fairly good job in managing user-local python versions, as well as per-version pip packages. However, some packages such as PyQt5 need deep system integration and can not be installed using pip. This makes packages such as jupyter-qtconsole upset. The use of shims in PyENV also forces any provided command to be started with a shell script (so a shell process). This makes packages such as python-powerline much slower.</p>
</div>
<div class="paragraph">
<p>To solve the above problems, I choose to go back to the standard python user-local install process and choose pip user install. pip user install relys on system python to work correctly, and integrates tightly with system packages. That is to say, if one install PyQt5 using system package manager, he/she can use it in a user-local toyplot package, avoiding install PyQt5 manually (since not possible with pip). Moreover, binaries provided by packages are directly avaliable to the system, which greatly improves the speed of packages such as python-powerline <span class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnote_1" title="View footnote.">1</a>]</span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="instructions">Instructions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>pip user install is good. Then how we do it? It&#8217;s as easy as following the listed steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Choose the user install location, say <code>$MYINSTALL</code>. By default, it&#8217;s
<code>$HOME/.local</code>.</p>
</li>
<li>
<p>Install packages we want using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span class="tok-nv">PYTHONUSERBASE</span><span class="tok-o">=</span><span class="tok-nv">$MYINSTALL</span> pip install --user --upgrade &lt;PACKAGES&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Setup python path and binary path</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span class="tok-nb">export </span><span class="tok-nv">PYTHONPATH</span><span class="tok-o">=</span><span class="tok-nv">$MYINSTALL</span>:<span class="tok-nv">$PYTHONPATH</span>
<span class="tok-nb">export </span><span class="tok-nv">PATH</span><span class="tok-o">=</span><span class="tok-nv">$MYINSTALL</span>/bin:<span class="tok-nv">$PATH</span></code></pre>
</div>
</div>
</li>
<li>
<p>Enjoy.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="integrate-with-system-packages">Integrate with system packages</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you install packages such as numpy, scipy and matplotlib with system package manager, and then install packages such as toyplot or jupyter, you may find that numpy, scipy will not be upgraded since the requirements of toyplot is already meet. This is the power of local install, which integrates well with existing packages.</p>
</div>
<div class="paragraph">
<p>But if you do want a more recent version that system provided, you can append <code>--upgrade</code> to <code>pip install</code>.</p>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_1">
<a href="#_footnoteref_1">1</a> python-powerline uses a binary powerline-client to accelerate shell prompt rendering, which is much more responsive than shell scripts. The latter causes visiable lag even on recent ivebridge CPUs.
</div>
</div>
    <br/>
    <div class="post-more">
      <a href="/contents/2015/09/20/user-local-python-pkg-install-with-pip/"> <i class="fa fa-link"></i> &nbsp; Read the rest
          of this post </b></a>
    </div>
  </div>
</article>



<!-- Pagination links -->
<div class="section-nav">
  <div class="left align-right">
    
      <span class="prev disabled">Newer</span>
    
  </div>
  <!--
  <div class="center align-center">
    Page: 1 of 5
  </div>
  -->
  <div class="right align-left">
    
      <a href="/blog/page2/" class="next">Older</a>
    
  </div>
</div>
<div class="clear"></div>


      </div>

      <div class="unit one-fifth hide-on-mobiles">
  <aside>
    <h4>Featured</h4>
    <ul>
        
        
        <li class="">
          <a href="/contents/2015/10/02/deploy-python-working-environments-using-pip/">Deploy python working environments with pip under restricted connections</a>
        </li>
        
        
        
        <li class="">
          <a href="/contents/2015/09/20/user-local-python-pkg-install-with-pip/">User-local python package install with pip</a>
        </li>
        
        
        
        
        
        
        
        
        
        
        
        <li class="">
          <a href="/contents/2015/05/05/using-rvm-to-isolate-rubygems-on-fedora-21/">Using RVM to Isolate RubyGems on Fedora 21</a>
        </li>
        
        
        
        
        
        <li class="">
          <a href="/contents/2015/04/27/prevent-gcc-optimize-away-code/">Prevent GCC from optimizing away a snippet of code</a>
        </li>
        
        
        
        
    </ul>
    <h4>Other Posts</h4>
    <ul>
        
        
        
        
        
        
        <li class="">
          <a href="/contents/2015/09/05/analyse-mpi-applications-with-intel-vtune-inspector/">Analyse MPI Applications with Intel VTune/Inspector</a>
        </li>
        
        
        
        <li class="">
          <a href="/contents/2015/07/25/home-python-ruby-with-pyenv-and-rvm/">Home-brew python and ruby with PyENV and RVM</a>
        </li>
        
        
        
        <li class="">
          <a href="/contents/2015/07/11/config-cjk-for-asciidoctor-fopub/">Config CJK fonts for Asciidoctor-fopub</a>
        </li>
        
        
        
        <li class="">
          <a href="/contents/2015/06/23/asciidoc-pdf-cjk-status/">Asciidoctor-pdf CJK support status</a>
        </li>
        
        
        
        
        
        <li class="">
          <a href="/contents/2015/05/01/fix-boost-python-argument-error-lvalue/">Fix Argument Error with lvalue In Boost.Python</a>
        </li>
        
        
        
        
        
        <li class="">
          <a href="/contents/2015/04/20/convert-chinese-asciidoc-to-pdf/">Convert Chinese Asciidoc Documents to PDF</a>
        </li>
        
        
    </ul>
  </aside>
</div>


      <div class="clear"></div>

    </div>
  </section>


  <footer role="contentinfo">
  <div class="grid">
    <div class="unit one-third center-on-mobiles">
      <p>The contents of this website are &copy;&nbsp;
      2015 by Yang Zhang under the terms of the MIT License.</p>
    </div>
    <div class="unit two-thirds align-right center-on-mobiles">
      <p>
        Proudly hosted by
        <a href="https://github.com">
          <img src="/img/footer-logo.png" width="100" height="30" alt="GitHub • Social coding">
        </a>
      </p>
    </div>
  </div>
</footer>

  <script>
  var anchorForId = function (id) {
    var anchor = document.createElement("a");
    anchor.className = "header-link";
    anchor.href      = "#" + id;
    anchor.innerHTML = "<span class=\"sr-only\">Permalink</span><i class=\"fa fa-link\"></i>";
    anchor.title = "Permalink";
    return anchor;
  };

  var linkifyAnchors = function (level, containingElement) {
    var headers = containingElement.getElementsByTagName("h" + level);
    for (var h = 0; h < headers.length; h++) {
      var header = headers[h];

      if (typeof header.id !== "undefined" && header.id !== "") {
        header.appendChild(anchorForId(header.id));
      }
    }
  };

  document.onreadystatechange = function () {
    if (this.readyState === "complete") {
      var contentBlock = document.getElementsByClassName("docs")[0] || document.getElementsByClassName("news")[0];
      if (!contentBlock) {
        return;
      }
      for (var level = 1; level <= 6; level++) {
        linkifyAnchors(level, contentBlock);
      }
    }
  };
</script>

  


  <!-- Google Analytics (http://google.com/analytics) -->
  <script>
    !function(j,e,k,y,l,L){j.GoogleAnalyticsObject=y,j[y]||(j[y]=function(){
    (j[y].q=j[y].q||[]).push(arguments)}),j[y].l=+new Date,l=e.createElement(k),
    L=e.getElementsByTagName(k)[0],l.src='//www.google-analytics.com/analytics.js',
    L.parentNode.insertBefore(l,L)}(window,document,'script','ga');

    ga('create', 'UA-62602586-1', 'auto');
    ga('send', 'pageview');

  </script>


    <!-- KaTeX auto render-->
  <script>
    var _options =  {
      delimiters: [
        {left: "$$", right: "$$", display: true},
        {left: "$", right: "$", display: false},
        {left: "\\[", right: "\\]", display: true},
        {left: "\\(", right: "\\)", display: false}
      ]
    };
    renderMathInElement(document.body, _options);
  </script>


</body>
</html>
